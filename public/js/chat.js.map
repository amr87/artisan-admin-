{"version":3,"sources":["Artisan.js","ArtisanChat.js","receiver.js","chat.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"chat.js","sourcesContent":["/* \n * @author: Amr Gamal\n * @date: 03-03-2016\n * @dependencies: [Jquery , underscorejs]\n */\n\n\"use strict\";\n\n$ = jQuery.noConflict();\n\nvar marqueeTitle, originalTitle = \"Dashboard\";\n\nwindow.Artisan = {};\n\nArtisan.getKey = function (props) {\n\n    if (!_.isObject(props)) {\n        console.error('You must pass props as an object.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n\n    for (var prop in props)\n        if (props.propertyIsEnumerable(prop))\n            return prop;\n}\n\nArtisan.filter = function (selector, filter) {\n\n    if (!_.isObject(selector)) {\n        console.error('You must pass selector as an object.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n\n    if (!_.isString(filter)) {\n        console.error('You must pass filter as an object.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n\n    return $(selector.selector + filter);\n}\n\n\nArtisan.hasScrollBar = function (elem) {\n    if (!_.isObject(elem)) {\n        console.error('You must pass elem as an object.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n\n    return $(elem).get(0).scrollHeight > $(elem).get(0).clientHeight;\n}\n\nArtisan.scrolledDown = function (elem) {\n    if (!_.isObject(elem)) {\n        console.error('You must pass elem as an object.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n\n    return  $(elem).get(0).scrollHeight - $(elem).scrollTop() == $(elem).outerHeight();\n}\n\n\nArtisan.Notification = function (props) {\n\n    if (!_.isObject(props)) {\n        console.error('You must pass props as an object.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n\n    noty({\n        text: props.text,\n        type: props.type,\n        dismissQueue: true,\n        layout: 'bottomLeft',\n        closeWith: ['click'],\n        theme: 'relax',\n        maxVisible: 10,\n        animation: {\n            open: 'animated ' + props.animation.open,\n            close: 'animated ' + props.animation.close,\n            easing: 'swing',\n            speed: 500\n        }\n    });\n}\n\nArtisan.titleMarquee = function (text) {\n\n    if (!_.isString(text)) {\n        console.error('You must pass text as an string.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n    originalTitle = document.title;\n    document.title = text;\n    var documentTitle = document.title + \" - \";\n\n    (function titleMarquee() {\n        document.title = documentTitle = documentTitle.substring(1) + documentTitle.substring(0, 1);\n        marqueeTitle = setTimeout(titleMarquee, 200);\n    })();\n}\n\nArtisan.resetDocumentTitle = function () {\n\n    window.clearTimeout(marqueeTitle);\n    document.title = originalTitle;\n    if (parseInt($(\"li.messages-menu\").find(\"span\").text()) > 0) {\n        $(\"li.messages-menu\").find(\"span\").text(parseInt($(\"li.messages-menu\").find(\"span\").text()) - 1);\n    }\n    $(\"li.messages-menu\").find(\"span\").removeClass(\"label-danger\").addClass(\"label-success\");\n}","/* \n * @author: Amr Gamal <amr.gamal878@gmail.com>\n * @date: 03-03-2016\n * @dependencies: [Jquery , underscorejs]\n */\n\n\"use strict\";\n\n$ = jQuery.noConflict();\n\nwindow.ArtisanChat = {};\n\nArtisanChat.holder = $(\".chat-area\");\n\nArtisanChat.count = 0;\n\nArtisanChat.position = 0;\n\nArtisanChat.chattingWith = \"\";\n\n\n\nArtisanChat.init = function (chat) {\n    \n\n\n    if (!_.isObject(chat)) {\n        console.error('You must pass props as an object.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n\n    this.count = Artisan.filter(this.holder, \":visible\").length;\n\n    this.position = this.count * parseInt(this.holder.css('width'));\n\n    $._widget = this.build(chat);\n\n    $._widget.fadeIn(\"slow\", function () {\n        \n        ArtisanChat.count++;\n\n        $._widget.attr(\"data-client\", $(chat).data('client'));\n\n        $._widget.attr(\"data-id\", $(chat).data('id'));\n\n        var text = $(chat).get(0).nodeName == \"SPAN\" ? $(chat).prev().text() : $(chat).data(\"with\");\n\n        $._widget.find(\".chat-with\").text(text);\n\n\n        var template = ArtisanChat.loadConversation(chat, null);\n\n        if (template.length)\n            $._widget.find(\".direct-chat-messages\").prepend($(\"<a class='prev-msg' href='#'><i class='fa fa-arrow-up'></i> Load More Messages<br/><span class='fa fa-spinner fa-spin'></span></a>\"));\n\n        $._widget.find(\".spin-it\").remove();\n\n        $._widget.find(\".direct-chat-messages\").append(template);\n\n\n\n        $._widget.find('input#message').typing({\n            start: function (event, $elem) {\n                var client = $elem.parent().parent().parent().parent().data(\"client\");\n                socket.emit('typing', {user_id: $(\"input#myId\").val(), target_id: $._widget.data('id'), client: client, senderClient: Artisan.filter($('span.chat-start'), \"[data-id='\" + $(\"input#myId\").val() + \"']\").data(\"client\")});\n            },\n            stop: function (event, $elem) {\n                var client = $elem.parent().parent().parent().parent().data(\"client\");\n                socket.emit('untyping', {user_id: $(\"input#myId\").val(), target_id: $._widget.data('id'), client: client, senderClient: Artisan.filter($('span.chat-start'), \"[data-id='\" + $(\"input#myId\").val() + \"']\").data(\"client\")});\n            },\n            delay: 400\n        });\n    });\n\n\n\n};\n\n\nArtisanChat.build = function (data) {\n\n    if (!_.isObject(data)) {\n        console.error('You must pass data as an object.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n\n    var key = _.isUndefined(data.selector) ? data.senderId : data.data('id');\n\n    var Current = Artisan.filter(this.holder, \"[data-id='\" + key + \"']\");\n\n    if (!Current.length) {\n\n        $._widget = this.holder.clone();\n\n        $._widget.css({right: this.position});\n\n    } else {\n\n        $._widget = Current;\n\n        this.RePosition('re-appear', $._widget);\n    }\n\n    $._widget.appendTo($('body'));\n\n    return $._widget;\n\n}\n\n\nArtisanChat.loadConversation = function (chat, threshold) {\n\n    var template = \"\";\n\n    var id = _.isObject(chat) ? chat.data('id') : chat;\n    var skip = threshold === null ? 0 : threshold;\n\n    $.ajax({\n        url: '/get-conversation',\n        type: 'GET',\n        data: {to: id, skip: skip},\n        async: false,\n        success: function (response) {\n\n            if (response.length) {\n\n                for (var i = 0; i < response.length; i++) {\n\n                    if (response[i].mine) {\n                        template += \"<div data-mine='1' data-id='\" + response[i].id + \"' data-seen='\" + response[i].seen + \"' class='direct-chat-msg'>\\n\";\n                        template += \"<div class='direct-chat-info clearfix'>\\n\";\n                        template += \" <span class='direct-chat-name pull-left'>\" + response[i].sender.display_name + \"</span>\\n\";\n                        template += \"<span class='direct-chat-timestamp pull-right'>\" + response[i].sent_at + \"</span>\\n\";\n                        template += \"</div>\\n\";\n                        template += \"<img class='direct-chat-img' src='\" + response[i].sender.avatar + \"' alt='Message User Image'>\\n\";\n                        template += \"<div class='direct-chat-text'>\\n\";\n                        template += response[i].text + \"\\n\";\n                        if (response[i].seen == \"1\" && i == (response.length - 1) && skip == 0) {\n                            template += \"<p class='seen-mark'><i class='fa fa-eye'></i> At \" + response[i].seen_at + \"</p>\";\n                        }\n                        template += \" </div>\\n\";\n                        template += \"</div>\"\n\n                    } else {\n                        template += \"<div data-mine='0' data-id='\" + response[i].id + \"' data-seen='\" + response[i].seen + \"' class='direct-chat-msg right'>\\n\";\n                        template += \"<div class='direct-chat-info clearfix'>\\n\";\n                        template += \" <span class='direct-chat-name pull-right'>\" + response[i].sender.display_name + \"</span>\\n\";\n                        template += \"<span class='direct-chat-timestamp pull-left'>\" + response[i].sent_at + \"</span>\\n\";\n                        template += \"</div>\\n\";\n                        template += \"<img class='direct-chat-img' src='\" + response[i].sender.avatar + \"' alt='Message User Image'>\\n\";\n                        template += \"<div class='direct-chat-text'>\\n\";\n                        template += response[i].text + \"\\n\";\n                        template += \" </div>\\n\";\n                        template += \"</div>\"\n                    }\n                }\n            }\n\n        }});\n\n    return template;\n\n};\n\n\n\nArtisanChat.sendMessage = function (object) {\n\n    if (!_.isObject(object)) {\n        console.error('You must pass object as an object.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n\n    var message = $(object).parent().prev().val();\n\n    if (message == \"\") {\n        alert(\"You must type a message\");\n        return;\n    }\n\n    var _widget = $(object).parent().parent().parent().parent().parent();\n\n\n    var id = _widget.data(\"id\");\n    var client = Artisan.filter($('span.chat-start'), \"[data-id='\" + id + \"']\").data(\"client\");\n    var name = _widget.data(\"name\");\n    var avatar = _widget.data(\"avatar\");\n\n    var senderId = $(\"input#myId\").val();\n\n    var senderClient = Artisan.filter($('span.chat-start'), \"[data-id='\" + senderId + \"']\").data(\"client\");\n\n\n    var template = \"\";\n    template += \"<div data-seen='1' data-mine='1' class='direct-chat-msg'>\\n\";\n    template += \"<div class='direct-chat-info clearfix'>\\n\";\n    template += \" <span class='direct-chat-name pull-left'>\" + name + \"</span>\\n\";\n    template += \"<span class='direct-chat-timestamp pull-left' data-timestamp='\" + new Date().getTime() + \"'>Now</span>\\n\";\n    template += \"</div>\\n\";\n    template += \"<img class='direct-chat-img' src='\" + avatar + \"' alt='Message User Image'>\\n\";\n    template += \"<div class='direct-chat-text'>\\n\";\n    template += message + \"\\n\";\n    template += \" </div>\\n\";\n    template += \"</div>\"\n\n    _widget.find(\".direct-chat-messages\").append(template);\n    _widget.find(\".direct-chat-messages\").animate({'scrollTop': _widget.find(\".direct-chat-messages\").get(0).scrollHeight + \"px\"});\n\n    _widget.find(\".seen-mark\").remove();\n    // save message\n    $.post('/post-message', {to: id, message: message}, function (response) {\n        var data = JSON.parse(response);\n        if (data.id != 0) {\n            //emit message\n            socket.emit('message', {message: message, client: client, user_id: id, name: name, avatar: avatar, senderId: senderId, sclient: senderClient, msg_id: data.id});\n        }\n    });\n\n    // clear message input\n    $(object).parent().prev().val(\"\");\n\n}\n\n\n\nArtisanChat.receiveMessage = function (data) {\n\n    if (!_.isObject(data)) {\n        console.error('You must pass data as an object.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n\n    /* \n     * increase message counter\n     * @todo increase for differnet conversation only as facebook does\n     */\n    var elem = $(\"li.messages-menu\").find(\"span\");\n    elem.removeClass('label-success').addClass(\"label-danger\").text(parseInt(elem.text()) + 1);\n\n    /*\n     * @ show message if the chat head is opened\n     * \n     */\n\n    var key = _.isUndefined(data.selector) ? data.senderId : data.data('id');\n\n    var Current = Artisan.filter(this.holder, \"[data-id='\" + key + \"']\");\n\n    if (Current.length) {\n        var template = \"\";\n\n        $._widget = Current;\n\n        $._widget.find('.box-header').addClass(\"redish\");\n\n        template += \"<div data-seen='0'  data-mine='0' data-id='\" + data.msg_id + \"' class='direct-chat-msg right'>\\n\";\n        template += \"<div class='direct-chat-info clearfix'>\\n\";\n        template += \" <span class='direct-chat-name pull-right'>\" + data.name + \"</span>\\n\";\n        template += \"<span class='direct-chat-timestamp pull-left' data-timestamp='\" + new Date().getTime() + \"'>Now</span>\\n\";\n        template += \"</div>\\n\";\n        template += \"<img class='direct-chat-img' src='\" + data.avatar + \"' alt='Message User Image'>\\n\";\n        template += \"<div class='direct-chat-text' style='height:30px !important'>\\n\";\n        template += data.message + \"\\n\";\n        template += \" </div>\\n\";\n        template += \"</div>\"\n        if (!$._widget.find(\".direct-chat-messages\").find(\"a.prev-msg\").length)\n            $._widget.find(\".direct-chat-messages\").prepend($(\"<a class='prev-msg' href='#'><i class='fa fa-arrow-up'></i> Load More Messages<br/><span class='fa fa-spinner fa-spin'></span></a>\"));\n\n        var hasScroll = Artisan.hasScrollBar($._widget.find('.direct-chat-messages'));\n        var scrolled = Artisan.scrolledDown($._widget.find('.direct-chat-messages'));\n        if (hasScroll && !scrolled && !$._widget.find(\"span.new-messages\").length) {\n            var alert = $(\"span.new-messages\").clone();\n            alert.prependTo($._widget.find('.box-body'))\n                    .fadeIn();\n\n        }\n\n        $._widget.find(\".direct-chat-messages\").append(template);\n        $._widget.find(\".seen-mark\").remove();\n    } else {\n\n        /*\n         * \n         * show notification if no chat head opened\n         */\n        var notyclose_id = $(\"#noty_bottomLeft_layout_container>li:first-child>.noty_bar\").attr('id');\n        var noty_list_count = $(\"#noty_bottomLeft_layout_container li\").size();\n        if (noty_list_count >= 1)\n            $.noty.close(notyclose_id);\n        Artisan.Notification({\n            text: \"<img class= 'direct-chat-img' src='\" + data.avatar + \"'/>\\n\\\n                <p><i class='fa fa-envelope'></i> <strong>\" + data.name + \" </strong> sent you a message.</p><div style='clear:both'</div>\\n\\\n                \",\n            type: 'success',\n            animation: {\n                open: 'zoomIn',\n                close: 'zoomOut'\n            }\n        });\n\n    }\n    /*\n     * \n     * Show the message on the dropdown\n     * \n     */\n    var li = $(\"li.chat-start[data-id='\" + key + \"']\");\n    if (li.length) {\n        if (!li.hasClass('pale-red'))\n            li.addClass('pale-red');\n\n        li.find(\"p\").text(data.message);\n        li.find(\"h4 small\").html(\"<i class='fa fa-clock-o'></i>Now\");\n\n    }\n\n    Artisan.titleMarquee(data.name + ' Messaged you');\n\n}\n\nArtisanChat.close = function (button) {\n\n    if (!_.isObject(button)) {\n        console.error('You must pass props as an object.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n\n    $(button).parent().parent().parent().parent().remove();\n\n    this.RePosition('delete', {});\n\n};\n\n\nArtisanChat.RePosition = function (action, widget) {\n\n    if (!_.isString(action) || !_.isObject(widget)) {\n        console.error('You must pass props as an object.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n\n    if (action == \"delete\") {\n\n        Artisan.filter(this.holder, ':visible').each(function (i, elem) {\n            $(elem).animate({right: i * parseInt($(elem).css('width')) + \"px\"}, 'slow');\n        });\n\n    } else if (action == \"re-appear\") {\n\n        var thisPos = parseInt(widget.css('right'));\n\n        var Visible = Artisan.filter(this.holder, ':visible');\n\n        Visible.each(function (i, elem) {\n\n            if (parseInt($(elem).css('right')) == thisPos && widget.css('style') != \"block\") {\n\n                var newPos = this.count * parseInt(ArtisanChat.css('width'));\n\n                $(elem).animate({right: newPos + \"px\"}, 'slow');\n            }\n        });\n\n    }\n\n}\n\nvar current;\n\nArtisanChat.setSeen = function (obj) {\n\n    if (!_.isObject(obj)) {\n        console.error('You must pass obj as an object.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n\n    current = $(obj);\n    $(current).find('.box-header').removeClass('redish');\n    Artisan.resetDocumentTitle();\n    if (Artisan.scrolledDown($(current).find(\".direct-chat-messages\"))) {\n        // find non seen messages\n        var notSeen = $(current).find(\".direct-chat-msg[data-seen='0']\");\n        if (notSeen.length) {\n            var ids = [];\n            for (var i = 0; i < notSeen.length; i++) {\n                ids.push($(notSeen[i]).data(\"id\"));\n            }\n            if (ids.length) {\n                if (current.data('requestRunning')) {\n                    return;\n                }\n                current.data('requestRunning', true);\n                $.ajax({\n                    type: \"POST\",\n                    url: \"/message-seen\",\n                    data: {id: ids},\n                    success: function (response) {\n                        var data = JSON.parse(response);\n                        if (data.length) {\n                            for (var j = 0; j < data.length; j++) {\n                                $(\".direct-chat-msg[data-id = '\" + data[j].id + \"']\").attr(\"data-seen\", \"1\");\n                            }\n                            var senderClient = Artisan.filter($('span.chat-start'), \"[data-id='\" + $(\"input#myId\").val() + \"']\").data(\"client\");\n                            socket.emit('seen', {user_id: $(\"input#myId\").val(), target_id: $._widget.data('id'), client: $(current).data(\"client\"), senderClient: senderClient, msg_id: data[j - 1].id, msg_seen: data[j - 1].seen_at});\n                        }\n                    },\n                    complete: function () {\n                        current.data('requestRunning', false);\n                    }\n                });\n\n\n            }\n        }\n    }\n}\n\nArtisanChat.loadPreviousMessages = function (obj) {\n    if (!_.isObject(obj)) {\n        console.error('You must pass obj as an object.');\n        alert('Sorry, something went terribly wrong, please refresh the page and try again.');\n        return;\n    }\n    $(obj).find('span').fadeIn();\n    var box = $(obj).parent().parent().parent().parent();\n    var id = box.data(\"id\");\n    var skip = $(obj).parent().find('.direct-chat-msg').length;\n    var template = ArtisanChat.loadConversation(id, skip);\n    $(obj).find('span').fadeOut();\n    $(template).insertAfter($(obj));\n    if (!template.length)\n        $(obj).remove();\n}\n\n\nArtisanChat.loadUserConversations = function () {\n\n    $.get('/user-conversations', {}, function (response) {\n        var data = JSON.parse(response);\n        var output = \"\";\n        if (data.length > 0) {\n\n            output += \"<li class='header'>You have \" + data.length + \" conversation(s)</li>\";\n            output += \"<li><ul class='menu conversation-holder'>\";\n            for (var i = 0; i < data.length; i++) {\n\n                if (data[i]['messages'][0]['mine']) {\n                    var selector = $(\"span.chat-start[data-id='\" + data[i]['messages'][0]['receiver']['id'] + \"']\");\n\n                    var client = selector.length ? selector.data('client') : null;\n                    var seenIcon = data[i]['messages'][0]['seen'] == \"1\" ? \"<i class='fa fa-eye'></i>\" : \"\";\n                    output += \" <li data-with='\" + data[i]['messages'][0]['receiver']['display_name'] + \"' class='chat-start' data-id='\" + data[i]['messages'][0]['receiver']['id'] + \"' data-client='\" + client + \"'> <a href='#'><div class='pull-left'>\";\n                    output += \" <img src='\" + data[i]['messages'][0]['receiver']['avatar'] + \"' class='img-circle' alt='User Image'></div> <h4>\\n\\\n                                                             \" + data[i]['messages'][0]['receiver']['display_name'] + \" \\n\\\n                                                                <small><i class='fa fa-clock-o'></i> \\n\\\n                                                             \" + data[i]['messages'][0]['sent_at'] + \"</small></h4>\\n\\\n                                                              <p>You: \" + data[i]['messages'][0]['text'] + \" \" + seenIcon + \"</p>\";\n                } else {\n                    var selector = $(\"span.chat-start[data-id='\" + data[i]['messages'][0]['sender']['id'] + \"']\");\n                    var seen = data[i]['messages'][0]['seen'] == \"1\" ? '' : 'pale-red';\n                    var client = selector.length ? selector.data('client') : null;\n                    output += \" <li data-with='\" + data[i]['messages'][0]['sender']['display_name'] + \"' class='chat-start \" + seen + \"' data-id='\" + data[i]['messages'][0]['sender']['id'] + \"' data-client='\" + client + \"'> <a href='#'><div class='pull-left'>\";\n                    output += \" <img src='\" + data[i]['messages'][0]['sender']['avatar'] + \"' class='img-circle' alt='User Image'></div>\\n\\\n                                  <h4>\" + data[i]['messages'][0]['sender']['display_name'] + \"   <small><i class='fa fa-clock-o'></i> \\n\\\n                                                             \" + data[i]['messages'][0]['sent_at'] + \"</small></h4>\\n\\\n                                                                <p>\" + data[i]['messages'][0]['text'] + \"</p>\";\n                }\n\n                output += \"</a></li>\";\n            }\n            output += \"</ul>\";\n            // output += \" <li class='footer'> <a href='$' > See All Messages </a></li>\";\n        } else {\n            output += \"<h4>No Conversations yet</h4>\";\n            output += \"</ul>\";\n        }\n\n        $(\"li.messages-menu\").find('ul.dropdown-menu').html(output);\n\n    });\n}\n","socket.on('user-login', function (data) {\n\n    $.get('/admin/users/saveClient', data, function () {});\n\n});\n\nsocket.on('user-update', function (data) {\n\n    var data = JSON.parse(data);\n    $('body').css('overflow', 'hidden');\n    $('.overlay-update').fadeIn('slow');\n\n    // Artisan.Notification({\n    //     text : 'User Updated ',\n    //     type :'warning',\n    //     animation:{\n    //         open:'zoomIn',\n    //         close:'zoomOut'\n    //     }\n    // });\n    $.post('/admin/users/flushSession', data, function () {});\n\n    window.setTimeout(function () {\n        window.location.reload();\n    }, 5000);\n\n});\n\nsocket.on('user-ban', function (data) {\n\n    var data = JSON.parse(data);\n    $('body').css('overflow', 'hidden');\n    $('.overlay-ban').fadeIn('slow');\n\n    window.setTimeout(function () {\n        window.location.href = \"/logout\";\n    }, 5000);\n\n});\n\nsocket.on('seen', function (data) {\n\n// data.msg_seen\n    var seen = $(\"<p/>\");\n    seen.addClass(\"seen-mark\");\n    var currentChat = $(\".chat-area[data-id='\" + data.user_id + \"']\");\n    if (currentChat.length) {\n        //currentChat.find(\".seen-mark\").remove();\n        seen.html(\"<i class='fa fa-eye'></i> At \" + data.msg_seen);\n        seen.appendTo(currentChat.find(\".direct-chat-text:last\"));\n    }\n\n});\n\n\nsocket.on('typing', function (data) {\n\n    var typing = $(\"<p/>\");\n    typing.addClass(\"typing\");\n    var currentChat = $(\".chat-area[data-id='\" + data.user_id + \"']\");\n    if (currentChat.length) {\n        if (currentChat.find('p.typing').length)\n            currentChat.find('p.typing').remove();\n        typing.html(\"<i class='fa fa-pencil'></i> typing....\");\n        typing.insertAfter(currentChat.find(\".direct-chat-text:last\"));\n    }\n});\n\nsocket.on('untyping', function (data) {\n    var currentChat = $(\".chat-area[data-id='\" + data.user_id + \"']\");\n    if (currentChat.find('p.typing').length)\n        currentChat.find(\".typing\").remove();\n\n});\n\n\nsocket.on('connectedUser', function (json) {\n\n    $(\"div.users-online\").find(\".control-sidebar-heading\").html(\" Online Users <strong style='color:yellow'>( \" + json.users.length + \" )</strong>\");\n\n    var output = \"\";\n\n    output += \"<ul id='online-users'>\";\n\n    for (var i = 0; i < json.users.length; i++) {\n\n        var k = Artisan.getKey(json.users[i]);\n\n        output += \"<li><img class='img-circle' src='\" + json.users[i].avatar + \"' width='50'/>\\n\\\n                        <a href='/users/'\"+json.users[i].id+\">\" + json.users[i].name + \"</a>\\n\\\n                        <span title='Chat with \" + json.users[i].name + \"' data-id='\" + k + \"'  data-client='\" + json.users[i][k] + \"' class='fa fa-lg fa-comment chat-start'></span>\\n\\\n                        \\n\\<div style='clear:both'></div>\\n\\\n                   </li>\";\n        if ($(\"ul.conversation-holder li[data-id='\" + k + \"']\").length) {\n            $(\"ul.conversation-holder li[data-id='\" + k + \"']\").attr(\"data-client\", json.users[i][k]);\n        }\n\n    }\n\n    output += \"</ul>\";\n\n    $(\".users-online\").find(\".overlay\").remove();\n    $(\".users-online\").find(\".box-body\").html(output);\n\n});","\n$(function () {\n\n    $(\"body\").delegate(\".chat-start\", \"click\", function () {\n        ArtisanChat.init($(this));\n    });\n\n    $(\"body\").delegate(\"button.send-message\", \"click\", function () {\n        ArtisanChat.sendMessage($(this));\n    });\n\n    $(\"body\").delegate(\"button.btn-close-chat\", \"click\", function () {\n        ArtisanChat.close($(this));\n    });\n\n    socket.on('message', function (data) {\n        ArtisanChat.receiveMessage(data);\n    });\n\n    $(\"body\").delegate(\"button[data-widget='collapse']\", \"click\", function () {\n        if ($(this).parent().parent().hasClass(\"redish\")) {\n            $(this).parent().parent().removeClass(\"redish\");\n        }\n    });\n\n    $(\"body\").delegate(\"span.new-messages\", \"click\", function () {\n\n        $(this).parent().find('.direct-chat-messages')\n                .animate({\n                    scrollTop: $(this).parent().find('.direct-chat-messages').get(0).scrollHeight + \"px\"\n                }, 'slow');\n        $(this).parent().prev().removeClass('redish');\n        $(this).remove();\n\n    });\n\n\n    $(\"body\").delegate(\".chat-area\", \"mouseover\", function () {\n        ArtisanChat.setSeen($(this));\n    });\n    \n\n    $(\"body\").delegate(\"a.prev-msg\", \"click\", function () {\n        ArtisanChat.loadPreviousMessages($(this));\n    });\n\n\n\n    $(\"li.messages-menu \").on(\"click\", function () {\n        ArtisanChat.loadUserConversations();\n    });\n\n\n    $(\"li.messages-menu\").on(\"click\", function () {\n        $(this).find(\"span\").removeClass(\"label-danger\").addClass(\"label-success\").text(0);\n        Artisan.resetDocumentTitle();\n    });\n\n   \n\n});"],"sourceRoot":"/source/"}